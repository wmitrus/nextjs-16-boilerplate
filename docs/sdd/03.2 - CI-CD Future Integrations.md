# CI/CD Future Integration Guide

This document explains how to add enterprise features to the existing CI/CD pipelines.

## 1. Sentry Integration

To add Sentry error tracking and source map uploads:

### GitHub Secrets Required:

- `SENTRY_AUTH_TOKEN`
- `SENTRY_ORG`
- `SENTRY_PROJECT`

### Workflow Changes:

Add these steps before the "Deploy" step in `preview-deploy.yml` and `prod-deploy.yml`:

```yaml
- name: Upload Source Maps to Sentry
  run: npx @sentry/cli sourcemaps upload .next --url-prefix '~/' --rewrite
  env:
    SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
    SENTRY_ORG: ${{ secrets.SENTRY_ORG }}
    SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT }}
    SENTRY_ENVIRONMENT: ${{ env.APP_ENV }}
    SENTRY_RELEASE: ${{ github.sha }}
```

## 2. Multi-tenant Configuration

If the project moves to a multi-tenant architecture:

### Environment Variables:

Update the "Build Project Artifacts" step to include tenant-specific flags:

```yaml
- name: Build Project Artifacts
  run: vercel build --token=${{ secrets.VERCEL_TOKEN }}
  env:
    MULTI_TENANT_ENABLED: 'true'
    DEFAULT_TENANT_ID: 'preview-tenant' # or 'default' for prod
```

## 3. Advanced Lighthouse (LHCI)

The current pipeline runs a basic Lighthouse audit. For persistent history and assertions:

### Steps:

1. Set up a [Lighthouse CI Server](https://github.com/GoogleChrome/lighthouse-ci/blob/main/docs/server.md).
2. Add `LHCI_TOKEN` to GitHub Secrets.
3. Update `lighthouserc.js` with assertions.
4. Update the workflow step:

```yaml
- name: Run Lighthouse Audit
  run: npx @lhci/cli autorun --upload.target=lhci --upload.token=${{ secrets.LHCI_TOKEN }}
```

## 4. E2E Label Trigger

To run Playwright E2E tests only when a PR has the `run-e2e` label:

Add a new job to `pr-validation.yml`:

```yaml
e2e-tests:
  if: contains(github.event.pull_request.labels.*.name, 'run-e2e')
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: Run E2E
      run: pnpm e2e:ci
```
